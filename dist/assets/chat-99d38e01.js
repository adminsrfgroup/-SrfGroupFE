import{j as e,q as J,c5 as me,t as Q,w as X,R as i,k as ie,B as S,P as pe,I as O,dd as fe,de as je,c1 as Ce,s as ne,v as V,o as Y,aK as be,E as $,F as G,a7 as Ue,ad as Se,a8 as _e,a9 as ye,ae as ge,ab as ke,ac as H,ao as Z,ap as M,N as De,O as Ee,u as Ae,$ as Pe,aa as Ne,b$ as Re,c0 as Te,a4 as Ie,bq as Le,d as K,V as ve,a as U,df as $e,dg as we,dh as Be,di as Fe,dj as ze,dk as Oe,dl as qe,aA as Ge,_ as We,dm as q,dn as ae,A as de,G as P,L as Ve,n as He,M as Ke,dp as Je,dq as Qe,aG as Xe,dr as Ye,g as Ze}from"./index-cc58a329.js";import{B as Me}from"./Breadcrumbs-27f8f572.js";import{C as er}from"./Container-c6f384ce.js";import{A as ce}from"./Alert-a2f3ba94.js";import{S as W}from"./Skeleton-861e561d.js";import{d as rr}from"./Delete-238cbf2a.js";import{S as tr}from"./styled-badge-c84ac5c8.js";import{C as oe}from"./react-time-ago-5fee5104.js";import{T as lr}from"./TextField-727dca04.js";import{F as sr,a as ar}from"./OutlinedInput-400299d2.js";import"./Close-751101d2.js";import"./index-a79bf066.js";function dr(){return e.jsx(J,{sx:{width:"100%",bgcolor:"background.paper"},children:[0,1,2].map(d=>e.jsxs(me,{alignItems:"flex-start",children:[e.jsx(Q,{children:e.jsx(W,{variant:"circular",width:40,height:40})}),e.jsx(X,{primary:e.jsx(W,{variant:"text"}),secondary:e.jsx(W,{variant:"text"})})]},`key-${d}`))})}function ir({loading:d,list:l,account:_,listMessages:N,isOnLine:h,deleteConversation:R,searchCallback:w}){const[T,o]=i.useState(!1),[B,D]=i.useState(void 0),[b,E]=i.useState(""),{t:y}=ie(),g=r=>{var c,x,s,u,t,a,p,f,j,C,k,z,le,se;return((x=(c=r==null?void 0:r.conversation)==null?void 0:c.senderUser)==null?void 0:x.id)===_.id?$((u=(s=r==null?void 0:r.conversation)==null?void 0:s.receiverUser)==null?void 0:u.id,(a=(t=r==null?void 0:r.conversation)==null?void 0:t.receiverUser)==null?void 0:a.imageUrl,(f=(p=r==null?void 0:r.conversation)==null?void 0:p.receiverUser)==null?void 0:f.sourceConnectedDevice):$((C=(j=r==null?void 0:r.conversation)==null?void 0:j.senderUser)==null?void 0:C.id,(z=(k=r==null?void 0:r.conversation)==null?void 0:k.senderUser)==null?void 0:z.imageUrl,(se=(le=r==null?void 0:r.conversation)==null?void 0:le.senderUser)==null?void 0:se.sourceConnectedDevice)},I=r=>{var c,x,s,u,t,a;return((x=(c=r==null?void 0:r.conversation)==null?void 0:c.senderUser)==null?void 0:x.id)===_.id?h(((u=(s=r==null?void 0:r.conversation)==null?void 0:s.receiverUser)==null?void 0:u.email)||""):h(((a=(t=r==null?void 0:r.conversation)==null?void 0:t.senderUser)==null?void 0:a.email)||"")},L=r=>{var c,x,s,u;return((x=(c=r==null?void 0:r.conversation)==null?void 0:c.senderUser)==null?void 0:x.id)===_.id?G((s=r==null?void 0:r.conversation)==null?void 0:s.receiverUser):G((u=r==null?void 0:r.conversation)==null?void 0:u.senderUser)},n=r=>{N(r)},m=(r,c)=>{r.stopPropagation(),o(!0),D(c)},v=()=>{o(!1)},A=()=>{o(!1),R(B)},F=()=>e.jsxs(Ue,{open:T,TransitionComponent:Se,keepMounted:!0,onClose:v,"aria-describedby":"alert-dialog-slide-description",children:[e.jsx(_e,{children:y("chat.title_delete_conversation")}),e.jsx(ye,{children:e.jsx(ge,{id:"alert-dialog-slide-description",children:y("chat.description_delete_conversation")})}),e.jsxs(ke,{children:[e.jsx(H,{onClick:v,color:"neutral",children:y("common.label_cancel")}),e.jsx(H,{onClick:A,color:"success",children:y("common.label_delete")})]})]});return e.jsxs(S,{children:[e.jsx("form",{children:e.jsxs(pe,{sx:{p:"2px 4px",display:"flex",alignItems:"center"},children:[e.jsx(O,{sx:{p:"10px"},"aria-label":"menu",children:e.jsx(fe,{})}),e.jsx(je,{sx:{ml:1,flex:1},placeholder:y("chat.label_search_by_name"),inputProps:{"aria-label":"search conversation"},name:"search",value:b,onChange:r=>E(r.target.value)}),e.jsx(O,{sx:{p:"10px"},"aria-label":"search",onClick:()=>w(b),children:e.jsx(Ce,{})})]})}),e.jsx("br",{}),d?e.jsx(dr,{}):e.jsxs(J,{sx:{width:"100%",bgcolor:"background.paper"},children:[l.map((r,c)=>{var x,s;return e.jsxs(S,{children:[e.jsxs(ne,{button:!0,alignItems:"flex-start",onClick:()=>n(r.conversation),secondaryAction:e.jsx(O,{edge:"end","aria-label":"delete",onClick:u=>m(u,r.conversation),children:e.jsx(rr,{color:"error"})}),children:[e.jsx(Q,{children:e.jsx(tr,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot",color:I(r)?"success":"error",children:e.jsx(V,{alt:"User avatar",src:g(r)})})}),e.jsx(X,{className:"item-conversation-infos",primary:L(r),secondary:e.jsxs(i.Fragment,{children:[e.jsx(Y,{sx:{display:"inline"},component:"span",variant:"body2",color:"text.primary",children:e.jsx(oe,{convertDate:(x=r==null?void 0:r.conversation)==null?void 0:x.dateCreated})}),` â€” ${(s=r==null?void 0:r.message)==null?void 0:s.content}`]})})]}),e.jsx(be,{variant:"inset",component:"li"})]},`conversation-${c}`)}),!d&&l.length===0?e.jsx(ce,{severity:"warning",children:"No Conversations found"}):null]}),e.jsx("div",{children:F()})]})}var ee={},nr=M;Object.defineProperty(ee,"__esModule",{value:!0});var xe=ee.default=void 0,cr=nr(Z()),or=e,xr=(0,cr.default)((0,or.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");xe=ee.default=xr;var re={},ur=M;Object.defineProperty(re,"__esModule",{value:!0});var ue=re.default=void 0,hr=ur(Z()),mr=e,pr=(0,hr.default)((0,mr.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM8.5 8c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8zM12 18c-2.28 0-4.22-1.66-5-4h10c-.78 2.34-2.72 4-5 4zm3.5-7c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"}),"EmojiEmotions");ue=re.default=pr;var te={},fr=M;Object.defineProperty(te,"__esModule",{value:!0});var he=te.default=void 0,jr=fr(Z()),Cr=e,br=(0,jr.default)((0,Cr.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos");he=te.default=br;const Ur={content:""},Sr=De({content:Ee().required("Message is required")}),_r=Ur;function yr({account:d,conversation:l,callbackAddMessage:_,loadingListMessages:N,listMessages:h,loadingAddMessage:R,totalPagesMessages:w,activePage:T,callbackLoadMoreMessages:o,calbackBackToConversations:B}){var u;const[D,b]=i.useState([]),[E,y]=i.useState(null),g=i.useRef(),I=Ae(),{t:L}=ie(),n=Pe({initialValues:_r,validationSchema:Sr,onSubmit:t=>{var p,f,j,C;const a={content:t.content,dateCreated:Le(new Date),isRead:!1,senderUser:{id:d.id,email:d.email,imageUrl:d.imageUrl,sourceConnectedDevice:d.sourceConnectedDevice},receiverUser:{id:(p=m())==null?void 0:p.id,email:(f=m())==null?void 0:f.email,imageUrl:(j=m())==null?void 0:j.imageUrl,sourceConnectedDevice:(C=m())==null?void 0:C.sourceConnectedDevice},conversation:{id:l.id}};b([...D,a]),_(a),n.resetForm(),setTimeout(()=>{g.current.scrollIntoView({behavior:"smooth"})},300)}});i.useEffect(()=>{x()},[]);const m=()=>{var t;return((t=l==null?void 0:l.senderUser)==null?void 0:t.id)===d.id?l==null?void 0:l.receiverUser:l==null?void 0:l.senderUser},v=()=>{var t,a,p,f,j,C,k;return((t=l==null?void 0:l.senderUser)==null?void 0:t.id)===d.id?$((a=l==null?void 0:l.receiverUser)==null?void 0:a.id,(p=l==null?void 0:l.receiverUser)==null?void 0:p.imageUrl,(f=l==null?void 0:l.receiverUser)==null?void 0:f.sourceConnectedDevice):$((j=l==null?void 0:l.senderUser)==null?void 0:j.id,(C=l==null?void 0:l.senderUser)==null?void 0:C.imageUrl,(k=l==null?void 0:l.senderUser)==null?void 0:k.sourceConnectedDevice)};i.useEffect(()=>{h.length?b(h.slice()):b([])},[h]),i.useEffect(()=>{E&&b([...D,E])},[E]);const A=t=>{var a;return((a=t==null?void 0:t.senderUser)==null?void 0:a.id)===(d==null?void 0:d.id)},F=t=>{var a,p,f,j,C,k,z;return((a=t==null?void 0:t.senderUser)==null?void 0:a.id)===(d==null?void 0:d.id)?$((p=t==null?void 0:t.receiverUser)==null?void 0:p.id,(f=t==null?void 0:t.receiverUser)==null?void 0:f.imageUrl,(j=t==null?void 0:t.receiverUser)==null?void 0:j.sourceConnectedDevice):$((C=t==null?void 0:t.senderUser)==null?void 0:C.id,(k=t==null?void 0:t.senderUser)==null?void 0:k.imageUrl,(z=t==null?void 0:t.senderUser)==null?void 0:z.sourceConnectedDevice)},r=()=>{o()},c=()=>{B()},x=()=>{},s=()=>{var t;((t=l==null?void 0:l.senderUser)==null?void 0:t.id)===d.id?setTimeout(()=>{var a;I(K.PROFILE+"/"+((a=l==null?void 0:l.receiverUser)==null?void 0:a.id))},300):setTimeout(()=>{var a;I(K.PROFILE+"/"+((a=l==null?void 0:l.senderUser)==null?void 0:a.id))},300)};return e.jsx("div",{className:"container-messages h-100",children:e.jsx("div",{className:"row clearfix h-100",children:e.jsx("div",{className:"col-lg-12 h-100",children:e.jsx("div",{className:"card chat-app h-100",children:e.jsxs("div",{className:"chat h-100",children:[e.jsx("div",{className:"chat-header clearfix",children:e.jsx(J,{sx:{width:"100%",maxWidth:360,bgcolor:"background.paper"},children:e.jsxs(ne,{button:!0,alignItems:"center",children:[e.jsx(O,{"aria-label":"upload picture",component:"span",onClick:c,sx:{display:{xs:"inline-flex",md:"none"}},children:e.jsx(he,{})}),e.jsx(Q,{onClick:()=>s(),children:e.jsx(V,{alt:"Remy Sharp",src:v(),children:(u=G(m()))==null?void 0:u.charAt(0)})}),e.jsx(X,{primary:G(m()),onClick:()=>s(),secondary:e.jsx(i.Fragment,{children:e.jsx(Y,{variant:"caption",children:m().email})})})]})})}),e.jsxs("div",{className:"chat-history",children:[w-1>T?e.jsx(S,{sx:{paddingTop:5,textAlign:"center"},children:e.jsx(H,{color:"neutral",variant:"outlined",onClick:r,children:L("common.label_load_more")})}):null,N?e.jsx(S,{sx:{pt:5,textAlign:"center"},children:e.jsx(Ne,{color:"inherit"})}):null,e.jsx("ul",{className:"m-b-0",children:D.map((t,a)=>e.jsxs("li",{className:"clearfix",children:[e.jsxs("div",{className:A(t)?"message-data text-right":"message-data message-data-other",children:[A(t)?null:e.jsx(V,{alt:"Photo",src:F(t),sx:{width:40,height:40,border:"1px solid #b9b9b9"},children:"A"}),e.jsx("div",{className:"message-data-time",children:e.jsx(oe,{convertDate:t==null?void 0:t.dateCreated})})]}),e.jsx("div",{className:A(t)?"message my-message float-right":"message other-message",children:t==null?void 0:t.content})]},`message-${a}-${t.id}`))}),e.jsx("div",{ref:g})]}),e.jsx("div",{className:"chat-message clearfix",children:e.jsx(S,{sx:{flexGrow:1},children:e.jsx("form",{onSubmit:n.handleSubmit,children:e.jsx(Re,{position:"static",color:"transparent",children:e.jsxs(Te,{children:[e.jsx(O,{size:"large",edge:"start",color:"inherit","aria-label":"open drawer",sx:{mr:2},children:e.jsx(ue,{})}),e.jsxs(sr,{variant:"standard",fullWidth:!0,error:n.touched.content&&!!n.errors.content,children:[e.jsx(lr,{id:"content",name:"content",label:L("chat.write_your_message"),variant:"standard",autoComplete:"off",value:n.values.content,onChange:n.handleChange}),e.jsx(ar,{id:"component-helper-text-message",children:n.touched.content&&n.errors.content})]}),e.jsx(S,{sx:{flexGrow:1}}),e.jsx(S,{children:e.jsx(Ie,{loading:R,variant:"text",color:"inherit",type:"submit",children:e.jsx(xe,{})})})]})})})})})]})})})})})}function $r(){const[d,l]=i.useState({}),[_,N]=i.useState([]),[h,R]=i.useState(-1),[w,T]=i.useState(!1),o=ve(),B=U($e)??!1,D=U(we)??[],b=U(Be)??0,E=U(Fe)??[],y=U(ze)??[],g=U(Oe)??[],I=U(qe)??[],L=U(Ge)??[],{currentUser:n}=U(We);i.useEffect(()=>{o(q({page:0,size:20}))},[]);const m=s=>{o(Je({...s}))},v=s=>{N([]),l(s),R(0),T(!0),o(Qe({})),o(ae({conversationId:s.id,page:0,size:de.MESSAGES_PER_PAGE}))};i.useEffect(()=>{if(g){const s=[];g.forEach((u,t)=>{s.unshift(u)}),N([...s,..._])}},[g]),i.useEffect(()=>{h>0&&o(ae({conversationId:d.id,page:h,size:de.MESSAGES_PER_PAGE}))},[h]);const A=()=>{R(h+1)},F=()=>{T(!1)},r=s=>Xe(L.slice(),s,n==null?void 0:n.email),c=s=>{o(Ye({id:s==null?void 0:s.id}))};i.useEffect(()=>{b&&o(q({page:0,size:20}))},[b]);const x=s=>{o(s?q({page:0,size:20,queryParams:Ze({"receiverUser.firstName":s})}):q({page:0,size:20}))};return e.jsxs(er,{maxWidth:"xl",children:[e.jsxs(P,{container:!0,style:{paddingTop:10},children:[e.jsx(P,{item:!0,xs:12,sm:6,md:1}),e.jsx(P,{item:!0,xs:12,sm:6,md:2,children:e.jsxs(Me,{"aria-label":"breadcrumb",children:[e.jsx(Ve,{color:"inherit",to:K.HOME,children:"SRF"}),e.jsx(Y,{color:"text.primary",children:"Chat"})]})})]}),e.jsxs(P,{container:!0,spacing:6,style:{marginTop:50},className:"container-chat",children:[e.jsx(P,{item:!0,xs:12,sm:6,md:2,sx:{display:{xs:"none",md:"flex"}}}),e.jsxs(P,{item:!0,xs:12,sm:6,md:3,className:"container-chat-conversation",children:[e.jsx(ir,{loading:B,list:D.slice(),account:n,listMessages:v,isOnLine:r,deleteConversation:c,searchCallback:x}),e.jsx(S,{sx:{mt:3,display:{xs:"none",md:"block"}},children:e.jsx("img",{className:"full-img-responsive",src:He("/assets/images/offer/details-offer/online_shoping_digital.jpg"),alt:"desktop-time-of-travel-address",style:{borderRadius:4}})})]}),e.jsx(P,{item:!0,xs:12,sm:12,md:5,className:w?"container-chat-message open":"container-chat-message",children:Ke(d)?e.jsx(S,{children:e.jsx(ce,{severity:"warning",children:"Please select a conversation"})}):e.jsx(yr,{account:n,conversation:d,callbackAddMessage:m,loadingListMessages:y,listMessages:_,loadingAddMessage:E,totalPagesMessages:I,activePage:h,callbackLoadMoreMessages:A,calbackBackToConversations:F})})]})]})}export{$r as default};
